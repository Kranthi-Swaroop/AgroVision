import{u as D,r as n,j as e,i as C,s as I}from"./index-Cj3VdF-t.js";const q=({message:s,isUser:r,timestamp:c})=>e.jsx("div",{className:`flex ${r?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-3 ${r?"bg-green-600 text-white rounded-br-md":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-bl-md"}`,children:[e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:s.split(`
`).map((a,i)=>{if(a.startsWith("**")&&a.includes(":**")){const d=a.split(":**");return e.jsxs("p",{className:"mb-1",children:[e.jsxs("strong",{className:r?"text-green-100":"text-green-700 dark:text-green-400",children:[d[0].replace(/\*\*/g,""),":"]}),d[1]]},i)}return a.startsWith("â€¢")||a.startsWith("-")?e.jsx("p",{className:"ml-2 mb-1",children:a},i):a.includes("âš ï¸")?e.jsx("p",{className:"font-bold text-yellow-300 dark:text-yellow-400 mb-2",children:a},i):a?e.jsx("p",{className:"mb-1",children:a},i):e.jsx("br",{},i)})}),e.jsx("p",{className:`text-xs mt-2 ${r?"text-green-200":"text-gray-400"}`,children:new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}),M=()=>e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-2xl rounded-bl-md px-4 py-3",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),E=({question:s,onClick:r})=>e.jsxs("button",{onClick:()=>r(s.text),className:"flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-green-50 dark:hover:bg-green-900/30 hover:border-green-300 dark:hover:border-green-600 transition-colors whitespace-nowrap",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{className:"truncate max-w-[200px]",children:s.text})]}),O=({text:s,onClick:r})=>e.jsx("button",{onClick:()=>r(s),className:"px-3 py-1.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-xs hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:s});function T(){const{t:s,language:r}=D(),[c,a]=n.useState([]),[i,d]=n.useState(""),[g,m]=n.useState(!1),[N,h]=n.useState([]),[p,b]=n.useState([]),[S]=n.useState(()=>`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),y=n.useRef(null),f=n.useRef(null),j=n.useCallback(()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})},[]);n.useEffect(()=>{j()},[c,j]),n.useEffect(()=>{(async()=>{try{const l=await C(r);h(l.questions||[])}catch(l){console.error("Failed to load quick questions:",l),h([{id:"q1",text:s("chat.quickQ1")||"What is late blight?",icon:"ðŸ…"},{id:"q2",text:s("chat.quickQ2")||"How to prevent diseases?",icon:"ðŸ›¡ï¸"},{id:"q3",text:s("chat.quickQ3")||"Organic pest control",icon:"ðŸŒ¿"}])}})()},[r,s]),n.useEffect(()=>{const t={id:Date.now(),text:s("chat.greeting"),isUser:!1,timestamp:new Date().toISOString()};a([t])},[r]);const w=async t=>{var v;if(!t.trim())return;const l={id:Date.now(),text:t.trim(),isUser:!0,timestamp:new Date().toISOString()};a(o=>[...o,l]),d(""),m(!0),b([]);try{const o=await I(t.trim(),r,S),x={id:Date.now()+1,text:o.response,isUser:!1,timestamp:o.timestamp||new Date().toISOString()};a(u=>[...u,x]),b(o.suggestions||[])}catch(o){console.error("Chat error:",o);const x={id:Date.now()+1,text:s("chat.error")||"Sorry, I encountered an error. Please try again.",isUser:!1,timestamp:new Date().toISOString()};a(u=>[...u,x])}finally{m(!1),(v=f.current)==null||v.focus()}},Q=t=>{t.preventDefault(),w(i)},k=t=>{w(t)};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-140px)] bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-sm px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl",children:"ðŸ¤–"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-gray-800 dark:text-white",children:s("chat.title")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("chat.subtitle")})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),s("chat.online")]})})]}),c.length<=1&&e.jsxs("div",{className:"px-4 py-3 bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:s("chat.quickQuestions")}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:N.map(t=>e.jsx(E,{question:t,onClick:k},t.id))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:[c.map(t=>e.jsx(q,{message:t.text,isUser:t.isUser,timestamp:t.timestamp},t.id)),g&&e.jsx(M,{}),p.length>0&&!g&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2 mb-4",children:p.map((t,l)=>e.jsx(O,{text:t,onClick:k},l))}),e.jsx("div",{ref:y})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 px-4 py-3",children:[e.jsxs("form",{onSubmit:Q,className:"flex gap-2",children:[e.jsx("input",{ref:f,type:"text",value:i,onChange:t=>d(t.target.value),placeholder:s("chat.placeholder"),className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 rounded-full text-gray-800 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500",disabled:g}),e.jsx("button",{type:"submit",disabled:!i.trim()||g,className:"px-4 py-3 bg-green-600 text-white rounded-full hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]}),e.jsx("p",{className:"text-xs text-center text-gray-400 mt-2",children:s("chat.disclaimer")})]})]})}export{T as default};
