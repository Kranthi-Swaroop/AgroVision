import{g as I,r as w,c as R,u as L,j as e,m as C,a as A,b as W,A as U}from"./index-Cj3VdF-t.js";var _={exports:{}};(function(u,S){(function(g,h){u.exports=h(w)})(R,function(m){return function(g){var h={};function d(i){if(h[i])return h[i].exports;var c=h[i]={i,l:!1,exports:{}};return g[i].call(c.exports,c,c.exports,d),c.l=!0,c.exports}return d.m=g,d.c=h,d.d=function(i,c,b){d.o(i,c)||Object.defineProperty(i,c,{enumerable:!0,get:b})},d.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},d.t=function(i,c){if(c&1&&(i=d(i)),c&8||c&4&&typeof i=="object"&&i&&i.__esModule)return i;var b=Object.create(null);if(d.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:i}),c&2&&typeof i!="string")for(var N in i)d.d(b,N,(function(M){return i[M]}).bind(null,N));return b},d.n=function(i){var c=i&&i.__esModule?function(){return i.default}:function(){return i};return d.d(c,"a",c),c},d.o=function(i,c){return Object.prototype.hasOwnProperty.call(i,c)},d.p="",d(d.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(g,h,d){d.r(h);var i=d("react"),c=function(){var x=function(a,t){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)n.hasOwnProperty(s)&&(r[s]=n[s])},x(a,t)};return function(a,t){x(a,t);function r(){this.constructor=a}a.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),b=function(){return b=Object.assign||function(x){for(var a,t=1,r=arguments.length;t<r;t++){a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(x[n]=a[n])}return x},b.apply(this,arguments)},N=function(x,a){var t={};for(var r in x)Object.prototype.hasOwnProperty.call(x,r)&&a.indexOf(r)<0&&(t[r]=x[r]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(x);n<r.length;n++)a.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(x,r[n])&&(t[r[n]]=x[r[n]]);return t};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(a){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise(function(r,n){t.call(navigator,a,r,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function M(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var k=function(x){c(a,x);function a(t){var r=x.call(this,t)||this;return r.canvas=null,r.ctx=null,r.requestUserMediaId=0,r.unmounted=!1,r.state={hasUserMedia:!1},r}return a.prototype.componentDidMount=function(){var t=this,r=t.state,n=t.props;if(this.unmounted=!1,!M()){n.onUserMediaError("getUserMedia not supported");return}r.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},a.prototype.componentDidUpdate=function(t){var r=this.props;if(!M()){r.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(t.audioConstraints)!==JSON.stringify(r.audioConstraints),s=JSON.stringify(t.videoConstraints)!==JSON.stringify(r.videoConstraints),v=t.minScreenshotWidth!==r.minScreenshotWidth,p=t.minScreenshotHeight!==r.minScreenshotHeight;(s||v||p)&&(this.canvas=null,this.ctx=null),(n||s)&&(this.stopAndCleanup(),this.requestUserMedia())},a.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},a.stopMediaStream=function(t){t&&(t.getVideoTracks&&t.getAudioTracks?(t.getVideoTracks().map(function(r){t.removeTrack(r),r.stop()}),t.getAudioTracks().map(function(r){t.removeTrack(r),r.stop()})):t.stop())},a.prototype.stopAndCleanup=function(){var t=this.state;t.hasUserMedia&&(a.stopMediaStream(this.stream),t.src&&window.URL.revokeObjectURL(t.src))},a.prototype.getScreenshot=function(t){var r=this,n=r.state,s=r.props;if(!n.hasUserMedia)return null;var v=this.getCanvas(t);return v&&v.toDataURL(s.screenshotFormat,s.screenshotQuality)},a.prototype.getCanvas=function(t){var r=this,n=r.state,s=r.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,p=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var f=v/p;v=s.minScreenshotWidth||this.video.clientWidth,p=v/f,s.minScreenshotHeight&&p<s.minScreenshotHeight&&(p=s.minScreenshotHeight,v=p*f)}this.canvas=document.createElement("canvas"),this.canvas.width=(t==null?void 0:t.width)||v,this.canvas.height=(t==null?void 0:t.height)||p,this.ctx=this.canvas.getContext("2d")}var y=this,o=y.ctx,l=y.canvas;return o&&l&&(l.width=(t==null?void 0:t.width)||l.width,l.height=(t==null?void 0:t.height)||l.height,s.mirrored&&(o.translate(l.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=s.imageSmoothing,o.drawImage(this.video,0,0,(t==null?void 0:t.width)||l.width,(t==null?void 0:t.height)||l.height),s.mirrored&&(o.scale(-1,1),o.translate(-l.width,0))),l},a.prototype.requestUserMedia=function(){var t=this,r=this.props,n=function(p,f){var y={video:typeof f<"u"?f:!0};r.audio&&(y.audio=typeof p<"u"?p:!0),t.requestUserMediaId++;var o=t.requestUserMediaId;navigator.mediaDevices.getUserMedia(y).then(function(l){t.unmounted||o!==t.requestUserMediaId?a.stopMediaStream(l):t.handleUserMedia(null,l)}).catch(function(l){t.handleUserMedia(l)})};if("mediaDevices"in navigator)n(r.audioConstraints,r.videoConstraints);else{var s=function(p){return{optional:[{sourceId:p}]}},v=function(p){var f=p.deviceId;return typeof f=="string"?f:Array.isArray(f)&&f.length>0?f[0]:typeof f=="object"&&f.ideal?f.ideal:null};MediaStreamTrack.getSources(function(p){var f=null,y=null;p.forEach(function(j){j.kind==="audio"?f=j.id:j.kind==="video"&&(y=j.id)});var o=v(r.audioConstraints);o&&(f=o);var l=v(r.videoConstraints);l&&(y=l),n(s(f),s(y))})}},a.prototype.handleUserMedia=function(t,r){var n=this.props;if(t||!r){this.setState({hasUserMedia:!1}),n.onUserMediaError(t);return}this.stream=r;try{this.video&&(this.video.srcObject=r),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(r)})}n.onUserMedia(r)},a.prototype.render=function(){var t=this,r=this,n=r.state,s=r.props,v=s.audio;s.forceScreenshotSourceSize;var p=s.disablePictureInPicture;s.onUserMedia,s.onUserMediaError,s.screenshotFormat,s.screenshotQuality,s.minScreenshotWidth,s.minScreenshotHeight,s.audioConstraints,s.videoConstraints,s.imageSmoothing;var f=s.mirrored,y=s.style,o=y===void 0?{}:y,l=s.children,j=N(s,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),O=f?b(b({},o),{transform:(o.transform||"")+" scaleX(-1)"}):o,E={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",b({autoPlay:!0,disablePictureInPicture:p,src:n.src,muted:!v,playsInline:!0,ref:function(P){t.video=P},style:O},j)),l&&l(E))},a.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},a}(i.Component);h.default=k},react:function(g,h){g.exports=m}}).default})})(_);var H=_.exports;const T=I(H),z={CRITICAL:"text-danger border-danger bg-danger/10",HIGH:"text-orange-500 border-orange-500 bg-orange-500/10",MODERATE:"text-yellow-500 border-yellow-500 bg-yellow-500/10",LOW:"text-success border-success bg-success/10",HEALTHY:"text-success border-success bg-success/10"};function F({data:u,onClose:S}){const{t:m,language:g}=L();if(!u)return null;const h=z[u.risk_level]||"text-gray-400 border-gray-400 bg-gray-400/10",d=m(`diseases.${u.disease}`)||u.disease.replace(/_/g," "),i=c=>{switch(c){case"CRITICAL":return m("results.criticalRisk");case"HIGH":return m("results.highRisk");case"MODERATE":return m("results.mediumRisk");case"LOW":return m("results.lowRisk");case"HEALTHY":return m("results.healthy");default:return c}};return e.jsxs(C.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},className:"fixed inset-x-0 bottom-16 z-40 bg-secondary rounded-t-2xl border-t border-theme p-4 max-h-[70vh] overflow-y-auto",children:[e.jsx("div",{className:"w-12 h-1 bg-gray-600 rounded-full mx-auto mb-4"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:`text-lg font-bold ${h.split(" ")[0]}`,children:d}),e.jsx("button",{onClick:S,className:"w-8 h-8 flex items-center justify-center rounded-full bg-primary text-secondary-color border border-theme",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:`p-4 rounded-xl border ${h}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-70",children:m("results.riskLevel")}),e.jsx("div",{className:"text-xl font-bold",children:i(u.risk_level)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs opacity-70",children:m("results.confidence")}),e.jsxs("div",{className:"text-xl font-bold",children:[(u.confidence*100).toFixed(0),"%"]})]})]}),e.jsx("div",{className:"mt-2 h-2 bg-black/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-current rounded-full transition-all",style:{width:`${u.risk_score*100}%`}})})]}),u.weather&&e.jsxs("div",{className:"p-3 bg-primary rounded-xl",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:m("results.weather")}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"bg-secondary rounded-lg p-2",children:[e.jsxs("div",{className:"text-lg font-bold",children:[u.weather.temperature.toFixed(0),"°"]}),e.jsx("div",{className:"text-xs text-gray-400",children:m("results.temperature")})]}),e.jsxs("div",{className:"bg-secondary rounded-lg p-2",children:[e.jsxs("div",{className:"text-lg font-bold",children:[u.weather.humidity,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:m("results.humidity")})]}),e.jsxs("div",{className:"bg-secondary rounded-lg p-2",children:[e.jsx("div",{className:"text-lg font-bold",children:u.weather.wind_speed.toFixed(0)}),e.jsx("div",{className:"text-xs text-gray-400",children:"Wind m/s"})]})]})]}),u.remedy&&u.risk_level!=="HEALTHY"&&e.jsxs("div",{className:"p-4 bg-primary rounded-xl border-l-4 border-accent",children:[e.jsx("div",{className:"text-xs text-accent mb-1",children:m("results.treatment")}),e.jsx("p",{className:"text-sm font-medium mb-2",children:u.remedy.spray}),e.jsx("div",{className:"flex gap-4 text-xs text-gray-400",children:e.jsxs("span",{children:[m("results.applicationInterval"),": ",u.remedy.repeat]})}),u.remedy.precautions&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-theme",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:m("results.precautions")}),e.jsx("p",{className:"text-xs text-secondary-color",children:u.remedy.precautions})]})]}),u.risk_level==="HEALTHY"&&e.jsxs("div",{className:"p-4 bg-success/10 rounded-xl border border-success",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-success font-medium",children:m("results.healthy")})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:g==="hi"?"सर्वोत्तम परिणामों के लिए नियमित निगरानी जारी रखें।":g==="te"?"ఉత్తమ ఫలితాల కోసం సాధారణ పర్యవేక్షణ కొనసాగించండి.":g==="ta"?"சிறந்த முடிவுகளுக்கு வழக்கமான கண்காணிப்பைத் தொடருங்கள்.":g==="kn"?"ಉತ್ತಮ ಫಲಿತಾಂಶಗಳಿಗಾಗಿ ನಿಯಮಿತ ಮೇಲ್ವಿಚಾರಣೆಯನ್ನು ಮುಂದುವರಿಸಿ.":"Continue regular monitoring for best results."})]})]})]})}const q=w.memo(F),B={facingMode:"environment",aspectRatio:3/4};function G(){const u=w.useRef(null),S=w.useRef(null),{result:m,loading:g,location:h,setResult:d,setLoading:i,setLocation:c,clearResult:b}=A(),[N,M]=w.useState(null),[k,x]=w.useState(null),[a,t]=w.useState(!1),{t:r,language:n}=L();w.useEffect(()=>{if(!navigator.geolocation){c({latitude:23.2599,longitude:77.4126});return}navigator.geolocation.getCurrentPosition(o=>c({latitude:o.coords.latitude,longitude:o.coords.longitude}),()=>c({latitude:23.2599,longitude:77.4126}))},[c]);const s=w.useCallback(async o=>{if(h){i(!0),x(null),t(!1);try{const l=new File([o],"capture.jpg",{type:"image/jpeg"}),j=await W(l,h.latitude,h.longitude);j.offline?(t(!0),d(null)):d(j)}catch(l){l.message==="offline"?t(!0):x(l.message||"Failed to analyze image")}i(!1)}},[h,i,d]),v=w.useCallback(async()=>{if(!u.current)return;const o=u.current.getScreenshot();if(!o)return;const j=await(await fetch(o)).blob();s(j)},[s]),p=w.useCallback(o=>{var j;const l=(j=o.target.files)==null?void 0:j[0];l&&(s(l),o.target.value="")},[s]),f=w.useCallback(()=>M(!0),[]),y={en:"Scan saved! It will be analyzed when you're back online.",hi:"स्कैन सहेजा गया! जब आप ऑनलाइन वापस आएंगे तो इसका विश्लेषण किया जाएगा।",te:"స్కాన్ సేవ్ చేయబడింది! మీరు తిరిగి ఆన్‌లైన్‌లో ఉన్నప్పుడు ఇది విశ్లేషించబడుతుంది.",ta:"ஸ்கேன் சேமிக்கப்பட்டது! நீங்கள் மீண்டும் ஆன்லைனில் இருக்கும்போது இது பகுப்பாய்வு செய்யப்படும்.",kn:"ಸ್ಕ್ಯಾನ್ ಉಳಿಸಲಾಗಿದೆ! ನೀವು ಮತ್ತೆ ಆನ್‌ಲೈನ್‌ನಲ್ಲಿರುವಾಗ ಇದನ್ನು ವಿಶ್ಲೇಷಿಸಲಾಗುತ್ತದೆ."};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:r("scanner.title")}),h&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h.latitude.toFixed(4),", ",h.longitude.toFixed(4)]})]}),k&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-sm text-center",children:k}),e.jsx(U,{children:a&&e.jsx(C.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-4 bg-yellow-500/20 border border-yellow-500/50 rounded-xl text-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-500/30 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-500",children:"Offline Mode"}),e.jsx("p",{className:"text-secondary-color text-xs mt-1",children:y[n]||y.en})]}),e.jsx("button",{onClick:()=>t(!1),className:"ml-auto text-secondary-color hover:text-primary",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),e.jsxs("div",{className:"flex-1 relative rounded-2xl overflow-hidden bg-black min-h-[300px]",children:[N?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-secondary",children:[e.jsx("svg",{className:"w-16 h-16 text-secondary-color mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"})}),e.jsx("p",{className:"text-gray-400 text-sm",children:r("scanner.cameraError")}),e.jsx("button",{onClick:()=>{var o;return(o=S.current)==null?void 0:o.click()},className:"mt-4 px-6 py-2 bg-accent text-primary rounded-lg font-medium",children:r("scanner.uploadImage")})]}):e.jsx(T,{ref:u,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:B,onUserMediaError:f,className:"absolute inset-0 w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"w-56 h-56 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-accent rounded-tl-lg"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-accent rounded-tr-lg"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-accent rounded-bl-lg"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-accent rounded-br-lg"})]})}),g&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-2 border-accent border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"text-sm mt-4",children:r("scanner.analyzing")})]})})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsxs(C.button,{onClick:v,disabled:g||!h||N,whileTap:{scale:.95},className:"flex-1 py-4 bg-accent text-primary font-bold rounded-xl disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),r(g?"scanner.analyzing":"scanner.takePhoto")]}),e.jsx(C.button,{onClick:()=>{var o;return(o=S.current)==null?void 0:o.click()},disabled:g||!h,whileTap:{scale:.95},className:"w-14 h-14 bg-secondary rounded-xl border border-theme flex items-center justify-center disabled:opacity-50",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("input",{ref:S,type:"file",accept:"image/*",capture:"environment",onChange:p,className:"hidden"})]}),e.jsx(U,{children:m&&e.jsx(q,{data:m,onClose:b})})]})}const Y=w.memo(G);export{Y as default};
